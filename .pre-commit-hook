#!/bin/bash

bibpath=./bibtex/bib/mendeley/
files=$(git diff --cached --name-only --diff-filter=ACMR $bibpath)

# Stash unstages changes
git stash -q --keep-index
# Run bibtool on changed bibliography
[[ ! -z ${files// /} ]] && echo "$(tput bold)Processing bibliography files...$(tput sgr0)"
for filename in $files; do
	if [[ "$filename" =~ .bib$ ]]; then
		echo "Processing $filename"
		bibtool -r .bibtool.res -i "$filename" -o "$filename"
	fi
done
# Restage files that were altered
git add -u
# Re-apply original unstaged changes
# git stash pop -q
